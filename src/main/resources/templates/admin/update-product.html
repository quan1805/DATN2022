<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments :: header">
</head>

<body class="dark-edition">
  <div class="wrapper ">
    <!-- Sidebar -->
    <div th:replace="fragments :: sidebar"></div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav th:replace="fragments :: navbar" ></nav>
      <!-- End Navbar -->
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header card-header-primary">
                                <h4 class="card-title">Update Product</h4>
<!--                                <p class="card-category">Complete your profile</p>-->
                            </div>
                            <div class="card-body">
                                <form th:action="@{/update-product/{id} ( id = ${product.id})}"  method="post" enctype="multipart/form-data" th:object="${product}">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Product name</label>
                                                <input type="text" th:field="*{name}" class="form-control" name="name" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="custom-file-upload" class="filupp">
                                                <label class="bmd-label-floating">Image Product</label>
                                                <input type="file" name="imageProduct" id="custom-file-upload"/>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Quantity</label>
                                                <input type="text" th:field="*{quantity}" class="form-control" name="quantity" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Hot</label>
                                                <input type="text" th:field="*{hot}" class="form-control" name="hot" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Price</label>
                                                <input type="text" th:field="*{price}" class="form-control" name="price" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Create Date</label>
                                                <input type="text" class="form-control" th:value="*{createDate}" name="createDate" >
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Update Date</label>
                                                <input type="text" class="form-control" th:value="*{updateDate}" >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Description</label>
                                                <textarea class="form-control" th:field="*{description}" rows="5" name="description" ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="">Product Category</label>
                                                <select name="category" class="form-select mt-3 w-100 text-center rounded border border-cus border-2" >
                                                    <option th:each="productcate : ${productcates}"
                                                            th:value="${productcate.id}"
                                                            th:text="${productcate.name}"/>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="">Brand</label>
                                                <select name="brand" class="form-select mt-3 w-100 text-center rounded border border-cus border-2" >
                                                    <option th:each="brand : ${brands}"
                                                            th:value="${brand.id}"
                                                            th:text="${brand.name}"/>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary pull-right">Save</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header card-header-primary">
                                <div class="row">
                                    <div class="col-md-4">
                                        <h5 class="card-title ">Product Detail</h5>
<!--                                        <p class="card-category">Complete your profile</p>-->
                                    </div>
                                    <div class="col-md-8 text-right">
                                        <div class="justify-content-end">
                                            <button type="button" class="btn btn-success text-right" data-toggle="modal" data-target="#addModal" data-whatever="@mdo">
                                                <span><i class="material-icons" style="margin-right:5px">&#xE147;</i></span>
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead class=" text-primary">
                                        <th>ID</th>
                                        <th>Size</th>
                                        <th>Price</th>
                                        <th>Promotion Price</th>
                                        <th>Quantity</th>
                                        <th>Actions</th>
                                        </thead>
                                            <tbody>
                                                <tr th:each="productdetail : ${productDetails}">
                                                    <td th:utext="${productdetail.id}"></td>
                                                    <td th:utext="${productdetail.size}"></td>
                                                    <td th:utext="${#numbers.formatCurrency(productdetail.price)}"></td>
                                                    <td th:utext="${#numbers.formatCurrency(productdetail.promotionPrice)}"></td>
                                                    <td th:utext="${productdetail.quantity}"></td>
                                                    <td class="td-actions">
                                                        <button type="button" rel="tooltip" title="Edit Product Detail" class="btn btn-white btn-link btn-sm">
                                                            <a id="editBtn" th:href="@{/findByIdProductDetail/(id = ${productdetail.id})}" class="edit" ><i class="material-icons">edit</i></a>
                                                        </button>
                                                        <button th:if="${productdetail.status} == 1" type="button" rel="tooltip" title="Remove" class="btn btn-white btn-link btn-sm">
                                                            <a id="deleteBtn" th:href="@{'/delete-product-detail/' + ${productdetail.id} + '/' + ${product.id} }" ><i class="material-icons">close</i></a>
                                                        </button>
                                                        <button th:if="${productdetail.status} == 0" type="button" rel="tooltip" title="Enable" class="btn btn-white btn-link btn-sm">
                                                            <a id="enableBtn" th:href="@{'/enable-product-detail/'+ ${productdetail.id} + '/' + ${product.id}}" ><i class="material-icons">check</i></a>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-4">
                        <div class="card card-profile">
                            <div class="card-body" style="margin-top: 0px">
                                <div class="avatar-preview">
                                    <img id="image-product" class="img" th:src="*{'data:image/jpeg;base64,' + {product.image}}" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer th:replace="fragments :: footer"></footer>
      <script>
        const x = new Date().getFullYear();
        let date = document.getElementById('date');
        date.innerHTML = '&copy; ' + x + date.innerHTML;
      </script>
    </div>
  </div>

  <!--   Add Modal-->
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <form th:action="@{'/add-product-detail/' + ${product.id}}" method="post" th:object="${productDetailNew}">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title text-center" id="exampleModalLabel" >New Product Detail</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <div class="form-group">
                          <label for="recipient-name" style="top:-20px" class="col-form-label">Size:</label>
                          <input style="color:black" type="text" class="form-control" id="recipient-name" th:field="*{size}">
                      </div>
                      <div class="form-group">
                          <label for="recipient-since" style="top:-20px"  class="col-form-label">Price:</label>
                          <input style="color:black" type="text" class="form-control" id="recipient-since" th:field="*{price}">
                      </div>
                      <div class="form-group">
                          <label for="recipient-address" style="top:-20px"  class="col-form-label">Promotion Price:</label>
                          <input style="color:black" type="text" class="form-control" id="recipient-address" th:field="*{promotionPrice}">
                      </div>
                      <div class="form-group">
                          <label for="recipient-phone" style="top:-20px"  class="col-form-label">Quantity:</label>
                          <input style="color:black" type="text" class="form-control" id="recipient-phone" th:field="*{quantity}">
                      </div>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary">Save</button>
                  </div>
              </div>
          </div>
      </form>
  </div>
  <!--   End Add Modal-->

  <!-- Edit Modal  -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
      <form th:action="@{'/update-product-detail/' + ${product.id}}" method="put">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title text-center" id="editModalLabel" >Edit Product Detail</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <div class="form-group">
                          <label for="idEdit" style="top:-20px" class="col-form-label">ID:</label>
                          <input style="color:black" type="text" class="form-control" id="idEdit" readonly name="id">
                      </div>
                      <div class="form-group">
                          <label for="sizeEdit" style="top:-20px" class="col-form-label">Size:</label>
                          <input style="color:black" type="text" class="form-control" id="sizeEdit" name = "Size">
                      </div>
                      <div class="form-group">
                          <label for="priceEdit" style="top:-20px" class="col-form-label">Price:</label>
                          <input style="color:black" type="text" class="form-control" id="priceEdit" name = "price">
                      </div>

                      <div class="form-group">
                          <label for="promotionPriceEdit" style="top:-20px"  class="col-form-label">Promotion Price:</label>
                          <input style="color:black" type="text" class="form-control" id="promotionPriceEdit" name = "promotionPrice">
                      </div>
                      <div class="form-group">
                          <label for="quantityEdit" style="top:-20px"  class="col-form-label">Quantity:</label>
                          <input style="color:black" type="text" class="form-control" id="quantityEdit" name = "quantity">
                      </div>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary">Save</button>
                  </div>
              </div>
          </div>
      </form>
  </div>
  <!-- End Edit Modal  -->

  <div th:replace="fragments :: fixed-plugin"></div>
  <div th:replace="fragments :: script"></div>
  <script type="text/javascript" th:inline="javascript">
    $(document).ready(function() {
        $('input[type="file"]').change(function(e){
            var value = $("input[type='file']").val();
            value =  value.split(/(\\|\/)/g).pop()
            console.log("value: " + value)
            $('.js-value').text(value);


            var input = e.target;
            if (input.files && input.files[0]) {
                var file = input.files[0];

                var reader = new FileReader();

                reader.readAsDataURL(file);
                reader.onload = function(e) {
                    $('#image-product').src = "hhhhhhhh"+reader.result;
                    document.getElementById("image-product").src = ""+reader.result;
                }
            }

        });


      var html = sessionStorage.getItem("notify") == null ?
              "<a class=\"dropdown-item\" href=\"javascript:void(0)\">Login successful</a>\n" :
              sessionStorage.getItem("notify");
      $('#notifications').html(html);
      $('.notification').html($('#notifications').children().length);

      // sessionStorage.setItem("notify", $('.dropdown-menu').html());
      $('table #editBtn').on('click', function (event){
        event.preventDefault();
        var href= $(this).attr('href');
        $.get(href, function (productDetail, status){
          $('#idEdit').val(productDetail.id);
          $('#sizeEdit').val(productDetail.size);
          $('#priceEdit').val(productDetail.price);
          $('#promotionPriceEdit').val(productDetail.promotionPrice);
          $('#quantityEdit').val(productDetail.quantity);
        })
        $('#editModal').modal();

      })

      var message = [[${message}]]
      if (message !== null && message !== '') {
        html = sessionStorage.getItem("notify") == null ?
                "<a class=\"dropdown-item\" href=\"javascript:void(0)\">Login successful</a>\n" :
                sessionStorage.getItem("notify");
        var html_message = "<a class=\"dropdown-item\" href=\"javascript:void(0)\">"+ message +"</a>"
        html += html_message
        $('#notifications').html(html);
        $('.notification').html($('#notifications').children().length);

        sessionStorage.clear();
        sessionStorage.setItem("notify", html);

        $.notify({
          // options
          title: '<strong>Notification</strong>',
          message: "" + message,
          icon: 'add_alert',
        },{
          // settings
          element: 'body',
          position: null,
          type: "info",
          allow_dismiss: true,
          newest_on_top: false,
          showProgressbar: false,
          placement: {
            from: "top",
            align: "right"
          },
          offset: 20,
          spacing: 10,
          z_index: 1031,
          delay: 3300,
          timer: 1000,
          url_target: '_blank',
          mouse_over: null,
          animate: {
            enter: 'animated rollIn',
            exit: 'animated rollOut'
          },
          onShow: null,
          onShown: null,
          onClose: null,
          onClosed: null,
          icon_type: 'class',
        });
      }
    });
  </script>
</body>

</html>